<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery | CUEE Camp 3</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        /* =========================================
           Theme & Styles (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
           ========================================= */
        :root {
            --maya-green: #5d866c;
            --maya-brown-dark: #624646;
            --maya-brown-red: #914F1E;
            --maya-sand: #DEAC80;
            --maya-cream: #F7DCB9;
            --maya-sage: #B5C18E;
        }

        body {
            background-color: var(--maya-cream);
            color: var(--maya-brown-dark);
            font-family: 'Prompt', sans-serif;
            background-image: radial-gradient(var(--maya-sand) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .theme-navbar {
            background-color: var(--maya-green) !important;
            border-bottom: 5px solid var(--maya-sage);
            box-shadow: 0 4px 15px rgba(93, 134, 108, 0.4);
            border-radius: 0 0 20px 20px;
        }

        .navbar-brand {
            color: #fff !important;
            font-weight: 700;
            text-shadow: 2px 2px 0px var(--maya-brown-dark);
        }

        .nav-link {
            color: #fff !important;
            font-weight: 500;
            transition: all 0.3s;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--maya-brown-dark) !important;
            background-color: var(--maya-cream);
            border-radius: 15px;
            font-weight: 700;
        }

        .navbar-toggler {
            border-color: #fff;
        }

        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(255, 255, 255, 1)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
        }

        /* Gallery Styles */
        .gallery-card {
            background-color: #fff;
            padding: 10px 10px 25px 10px;
            box-shadow: 0 4px 8px rgba(98, 70, 70, 0.2);
            border-radius: 4px;
            transition: all 0.3s ease;
            transform: rotate(0deg);
            cursor: pointer;
        }

        .gallery-card:hover {
            transform: scale(1.05) rotate(1deg);
            box-shadow: 0 10px 20px rgba(98, 70, 70, 0.3);
            z-index: 10;
        }

        .gallery-img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border: 1px solid #eee;
            background-color: #eee;
        }

        .folder-title {
            color: var(--maya-brown-red);
            border-left: 5px solid var(--maya-green);
            padding-left: 15px;
            margin-top: 40px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .theme-footer {
            background-color: var(--maya-brown-dark) !important;
            border-top: 6px solid var(--maya-brown-red);
            color: #fff;
        }

        .maya-social-btn {
            width: 40px;
            height: 40px;
            background-color: var(--maya-brown-red);
            color: white !important;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 1.2rem;
            text-decoration: none;
            transition: all 0.3s;
        }

        .maya-social-btn:hover {
            transform: translateY(-3px);
            background-color: var(--maya-sage);
            color: var(--maya-brown-dark) !important;
        }
    </style>
</head>

<body class="d-flex flex-column min-vh-100">

    <nav class="navbar navbar-expand-lg theme-navbar sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">‚ö° CUEE Camp 3rd</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="index.html">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></li>
                    <li class="nav-item"><a class="nav-link" href="about.html">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢</a></li>
                    <li class="nav-item"><a class="nav-link" href="calendar.html">‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a></li>
                    <li class="nav-item"><a class="nav-link active" href="photos.html">‡∏†‡∏≤‡∏û‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section class="py-5">
        <div class="container">
            <h2 class="text-center mb-4 fw-bold" style="color: var(--maya-brown-dark); text-shadow: 2px 2px 0 #fff;">
                üì∏ ‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏Ñ‡πà‡∏≤‡∏¢ CUEE Camp
            </h2>

            <div id="loading" class="text-center py-5">
                <div class="spinner-border" role="status"
                    style="width: 3rem; height: 3rem; color: var(--maya-brown-red);">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3 fw-bold" style="color: var(--maya-brown-dark);">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå...</p>
            </div>

            <div id="gallery-wrapper"></div>
        </div>
    </section>

    <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content bg-transparent border-0">
                <div class="modal-body position-relative p-0 text-center">
                    <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3"
                        data-bs-dismiss="modal" aria-label="Close"
                        style="z-index: 1050; background-color: var(--maya-brown-red); opacity: 1; padding: 10px; border-radius: 50%;">
                    </button>
                    <img src="" id="modalImage" class="img-fluid rounded shadow-lg"
                        style="border: 5px solid #fff; max-height: 90vh;">
                </div>
            </div>
        </div>
    </div>

    <footer class="theme-footer py-4 mt-auto">
        <div class="container text-center">
            <div class="d-flex justify-content-center gap-3 mb-3">
                <a href="#" class="maya-social-btn"><i class="bi bi-facebook"></i></a>
                <a href="#" class="maya-social-btn"><i class="bi bi-instagram"></i></a>
                <a href="#" class="maya-social-btn"><i class="bi bi-tiktok"></i></a>
            </div>
            <p class="mb-0 small" style="opacity: 0.8;">&copy; 2025 CUEE Camp | Faculty of Engineering, Chula</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // ‚ö†Ô∏è API KEY ‡πÄ‡∏î‡∏¥‡∏°
        const API_KEY = 'AIzaSyCMqD2pqXaOHLhBgfRgKxPaKTmfbf91etM';

        // ‚ö†Ô∏è ID ‡∏Ç‡∏≠‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å
        const MAIN_FOLDER_ID = '1-5mkMK_Z9rIMX0hfowNEkYyefrZpdjWB';

        // Modal Setup
        const modalElement = document.getElementById('imageModal');
        const modalImage = document.getElementById('modalImage');
        const myModal = new bootstrap.Modal(modalElement);

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á "‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå"
        async function fetchFolders(parentFolderId) {
            const query = `'${parentFolderId}'+in+parents+and+mimeType='application/vnd.google-apps.folder'+and+trashed=false`;
            const response = await fetch(`https://www.googleapis.com/drive/v3/files?q=${query}&key=${API_KEY}&fields=files(id,name)`);
            const data = await response.json();
            return data.files || [];
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á "‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û"
        async function fetchImages(folderId) {
            const query = `'${folderId}'+in+parents+and+mimeType+contains+'image/'+and+trashed=false`;
            const response = await fetch(`https://www.googleapis.com/drive/v3/files?q=${query}&key=${API_KEY}&fields=files(id,name)`);
            const data = await response.json();
            return data.files || [];
        }

        async function initGallery() {
            const wrapper = document.getElementById('gallery-wrapper');
            const loading = document.getElementById('loading');

            try {
                // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏î‡∏¥‡∏ö‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô
                let folders = await fetchFolders(MAIN_FOLDER_ID);

                loading.style.display = 'none';

                if (folders.length === 0) {
                    wrapper.innerHTML = '<p class="text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ô‡∏µ‡πâ</p>';
                    return;
                }

                // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ: ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "Day" (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πá‡∏Å/‡πÉ‡∏´‡∏ç‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ)
                folders = folders.filter(folder => folder.name.toLowerCase().includes('day'));

                if (folders.length === 0) {
                    wrapper.innerHTML = '<p class="text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "Day"</p>';
                    return;
                }

                // 2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (Day 1, Day 2...)
                folders.sort((a, b) => {
                    const numA = parseInt(a.name.match(/\d+/)) || 0;
                    const numB = parseInt(b.name.match(/\d+/)) || 0;
                    if (numA !== numB) return numA - numB;
                    return a.name.localeCompare(b.name);
                });

                // 3. ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß
                for (const folder of folders) {
                    const images = await fetchImages(folder.id);

                    if (images.length > 0) {
                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Header
                        const header = document.createElement('h3');
                        header.className = 'folder-title';
                        header.textContent = `üìÇ ${folder.name}`;
                        wrapper.appendChild(header);

                        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Grid
                        const row = document.createElement('div');
                        row.className = 'row g-4 mb-5';

                        images.forEach(file => {
                            const col = document.createElement('div');
                            col.className = 'col-md-4 col-sm-6';
                            const imageUrl = `https://drive.google.com/thumbnail?id=${file.id}&sz=w800`;

                            col.innerHTML = `
                                    <div class="gallery-card zoomable-trigger" data-img-src="${imageUrl}">
                                        <img src="${imageUrl}" class="gallery-img" alt="${file.name}" loading="lazy">
                                    </div>
                                `;
                            row.appendChild(col);
                        });

                        wrapper.appendChild(row);
                    }
                }

                // 4. ‡∏ú‡∏π‡∏Å Event Click
                document.querySelectorAll('.zoomable-trigger').forEach(card => {
                    card.addEventListener('click', function () {
                        const imgSrc = this.getAttribute('data-img-src');
                        modalImage.src = imgSrc;
                        myModal.show();
                    });
                });

            } catch (error) {
                console.error('Error:', error);
                loading.innerHTML = `<p class="text-danger text-center">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</p>`;
            }
        }

        document.addEventListener('DOMContentLoaded', initGallery);
    </script>
</body>

</html>
